Add file â†’ Create new file
app.py
import streamlit as st
import pandas as pd
import os

st.set_page_config(page_title="Dry Gas CSV Tool", layout="wide")
st.title("ğŸ’¨ Dry Gas Testing CSV Comparator & Validator")

# ğŸ”¹ Try to load built-in master CSV if available
default_master_path = "TestData53684.csv"
if os.path.exists(default_master_path):
    master_df = pd.read_csv(default_master_path)
    st.success("âœ… Default master CSV loaded successfully!")
else:
    master_df = pd.DataFrame()
    st.info("No default master CSV found â€” please upload one manually.")

# ğŸ”¹ Upload new master or test CSV
uploaded_master = st.file_uploader("ğŸ“‚ Upload New Master CSV (optional)", type=["csv"])
test = st.file_uploader("ğŸ“‚ Upload Test CSV", type=["csv"])

if uploaded_master is not None:
    master_df = pd.read_csv(uploaded_master)

if not master_df.empty:
    st.subheader("ğŸ§¾ Master CSV (Editable)")
    edited = st.data_editor(master_df, num_rows="dynamic", use_container_width=True)
    st.download_button("ğŸ’¾ Download Updated Master CSV", edited.to_csv(index=False), "master_updated.csv")
else:
    st.warning("ğŸ‘ˆ Upload or provide a master CSV to begin.")

if test is not None and not master_df.empty:
    st.subheader("ğŸ” Comparison Results")
    test_df = pd.read_csv(test)
    diffs = []
    all_cols = list(pd.Index(edited.columns).union(test_df.columns))
    edited, test_df = edited.reindex(columns=all_cols), test_df.reindex(columns=all_cols)
    for r in range(max(len(edited), len(test_df))):
        for c in all_cols:
            a = edited[c].iloc[r] if r < len(edited) else None
            b = test_df[c].iloc[r] if r < len(test_df) else None
            if str(a) != str(b):
                diffs.append({"Row": r, "Column": c, "Master": a, "Test": b})
    if diffs:
        diff_df = pd.DataFrame(diffs)
        st.warning(f"âš ï¸ Found {len(diffs)} differences.")
        st.dataframe(diff_df, use_container_width=True)
        st.download_button("â¬‡ï¸ Download Diff Report", diff_df.to_csv(index=False), "diff_report.csv")
    else:
        st.success("âœ… No differences found!")

# ğŸ”¹ Validation checks
if not master_df.empty:
    st.subheader("ğŸ§ª Validation")
    issues = []
    for i, row in master_df.iterrows():
        if "DriveTorque" in row and (row["DriveTorque"] < -1 or row["DriveTorque"] > 1):
            issues.append({"Row": i, "Column": "DriveTorque", "Value": row["DriveTorque"], "Issue": "Out of range (-1 to 1)"})
        if "DriveSpeed" in row and row["DriveSpeed"] < 0:
            issues.append({"Row": i, "Column": "DriveSpeed", "Value": row["DriveSpeed"], "Issue": "Negative speed"})
    if issues:
        val_df = pd.DataFrame(issues)
        st.error(f"ğŸš¨ Found {len(val_df)} validation issues!")
        st.dataframe(val_df)
    else:
        st.success("âœ… All validation checks passed!")
